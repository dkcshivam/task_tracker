{% extends 'base.html' %}

{% block content %}
<h3>All Comments</h3>

<!-- 🔍 Search and Filter Form -->
<form method="get" class="row g-2 mb-4" id="filter-form">
    <!-- Search by Task Name -->
    <div class="col-md-4 col-lg-3">
        <input type="text" name="search" class="form-control" placeholder="Search by Task Name" value="{{ request.GET.search }}" id="search-input">
    </div>

    <!-- Filter by Comment Text -->
    <div class="col-md-4 col-lg-3">
        <input type="text" name="comment_text" class="form-control" placeholder="Search by Comment" value="{{ request.GET.comment_text }}">
    </div>

    <!-- Filter by Created Date -->
    <div class="col-md-4 col-lg-2">
        <input type="date" name="created_at" class="form-control" value="{{ request.GET.created_at }}">
    </div>

    <div class="col-12 col-lg-auto">
        <button type="submit" class="btn btn-outline-primary w-100">Search</button>
    </div>
</form>

<!-- Comments Table -->
<table class="table table-bordered table-striped table-responsive" id="comments-table">
    <thead class="table-light">
        <tr>
            <th>#</th>
            <th>Task</th>
            <th>Comment</th>
            <th>Created At</th>
        </tr>
    </thead>
    <tbody id="comments-table-body">
        {% for comment in comments %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ comment.task.task_name }}</td>
            <td>{{ comment.comment_text }}</td>
            <td>{{ comment.created_at|date:"d M Y, H:i" }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">No comments available.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    // Listen for keyup event on search input field
    document.getElementById('search-input').addEventListener('keyup', function() {
        let searchTerm = this.value.toLowerCase();
        let commentRows = document.querySelectorAll('#comments-table-body tr');
        
        commentRows.forEach(function(row) {
            let taskName = row.querySelector('td:nth-child(2)').innerText.toLowerCase();
            let commentText = row.querySelector('td:nth-child(3)').innerText.toLowerCase();
            
            // Filter rows based on search term
            if (taskName.includes(searchTerm) || commentText.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });

    // Filter based on form submission
    document.getElementById('filter-form').addEventListener('submit', function(event) {
        // Here you can handle server-side filtering or more advanced client-side filtering
        // For now, just reloading the page with the updated filter query.
    });
</script>

{% endblock %}
